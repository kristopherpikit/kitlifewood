<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Application Form</title>
    <style>
        /* --- CSS Design Starts Here --- */
        :root {
            --primary-color: #00563B; /* Castleton Green */
            --secondary-color: #E1A95F; /* Earth Yellow */
            --light-gray: #ccc;
            --dark-gray: #555;
            --background: #F7F7F7;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--background);
            margin: 0; padding: 40px 20px; display: flex;
            justify-content: center; align-items: center; color: #0A110F;
        }
        .form-container {
            background-color: #FFFFFF; padding: 40px; border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); width: 100%;
            max-width: 700px; box-sizing: border-box;
        }
        h1 { color: var(--primary-color); text-align: center; margin-top: 0; margin-bottom: 10px; }
        p { text-align: center; color: var(--dark-gray); margin-bottom: 30px; }
        
        /* --- NEW: Progress Bar Styles --- */
        .progress-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
        }
        .progress-step {
            width: 35px; height: 35px; border-radius: 50%;
            background-color: #efefef; border: 3px solid var(--light-gray);
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; color: var(--light-gray);
            transition: all 0.3s ease;
            position: relative; z-index: 2;
        }
        .progress-step.active {
            border-color: var(--primary-color);
            background-color: var(--primary-color);
            color: white;
        }
        .progress-bar::before { /* The background line */
            content: ''; position: absolute; top: 50%;
            transform: translateY(-50%); height: 4px;
            width: 100%; background-color: #efefef; z-index: 1;
        }
        #progress-line { /* The active line */
            position: absolute; top: 50%;
            transform: translateY(-50%); height: 4px;
            width: 0%; background-color: var(--primary-color);
            z-index: 1; transition: width 0.4s ease;
        }

        /* --- Form Step Styling --- */
        .form-step {
            display: none; /* Hide all steps by default */
        }
        .form-step.active-step {
            display: block; /* Show only the active step */
        }
        fieldset { border: 2px solid var(--secondary-color); border-radius: 8px; padding: 25px; }
        legend { font-size: 1.2em; font-weight: 600; color: var(--primary-color); padding: 0 10px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; }
        input, select, textarea {
            width: 100%; padding: 12px; border: 1px solid var(--light-gray); border-radius: 5px;
            box-sizing: border-box; background-color: #F8F9FA; color: #0A110F;
            font-size: 16px; transition: border-color 0.3s, box-shadow 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none; border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(225, 169, 95, 0.25);
        }
        input.invalid { /* NEW: Style for invalid fields */
            border-color: #dc3545;
        }

        /* --- NEW: Navigation Button Styles --- */
        .form-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }
        .nav-btn {
            padding: 12px 30px; border-radius: 5px; border: none;
            font-size: 16px; font-weight: 700; cursor: pointer;
            transition: all 0.3s;
        }
        #prevBtn {
            background-color: transparent;
            border: 2px solid var(--light-gray);
            color: var(--dark-gray);
        }
        #prevBtn:hover {
            border-color: var(--dark-gray);
        }
        #nextBtn, #submitButton {
            background-color: var(--primary-color);
            color: white;
            display: flex; align-items: center; gap: 10px;
        }
        #nextBtn:hover, #submitButton:hover:not(:disabled) {
            background-color: #00422d;
        }
        #submitButton:disabled { background-color: #555; cursor: not-allowed; }

        /* Loader for submit button */
        .loader {
            width: 18px; height: 18px; border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%; border-top-color: #fff;
            animation: spin 1s ease-in-out infinite; display: none;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>Job Application Form</h1>
        <p>Please fill out the form below to apply for a position.</p>

        <!-- NEW: Progress Bar -->
        <div class="progress-bar">
            <div id="progress-line"></div>
            <div class="progress-step active" data-title="Personal">1</div>
            <div class="progress-step" data-title="Details">2</div>
            <div class="progress-step" data-title="Availability">3</div>
        </div>

        <form id="applicationForm">
            <!-- Step 1: Personal Information -->
            <div class="form-step active-step">
                <fieldset>
                    <legend>Personal Information</legend>
                    <div><label for="firstName">First Name:</label><input type="text" id="firstName" name="firstName" required></div><br>
                    <div><label for="lastName">Last Name:</label><input type="text" id="lastName" name="lastName" required></div><br>
                    <div><label for="email">Email:</label><input type="email" id="email" name="email" required></div><br>
                    <div><label for="age">Age:</label><input type="number" id="age" name="age" min="18" required></div>
                </fieldset>
            </div>

            <!-- Step 2: Application Details -->
            <div class="form-step">
                <fieldset>
                    <legend>Application Details</legend>
                    <div><label for="degree">Degree:</label><select id="degree" name="degree" required><option value="">--Please choose an option--</option><option value="BS in Information Technology">Bachelor of Science in Information Technology (BSIT)</option><option value="BS in Computer Science">Bachelor of Science in Computer Science (BSCS)</option><option value="BS in Information Systems">Bachelor of Science in Information Systems (BSIS)</option><option value="BS in Computer Engineering">Bachelor of Science in Computer Engineering (BSCpE)</option><option value="Other">Other</option></select></div><br>
                    <div><label for="projectApplied">Project Applied for:</label><select id="projectApplied" name="projectApplied" required><option value="">--Please choose a project--</option><option value="Predictive Healthcare Diagnostics">Predictive Healthcare Diagnostics</option><option value="Nexus Predictive Engine">Nexus Predictive Engine</option><option value="Automated Financial Auditing">Automated Financial Auditing</option><option value="E-commerce Personalization Engine">E-commerce Personalization Engine</option><option value="Agri-Tech Yield Maximizer">Agri-Tech Yield Maximizer</option><option value="Intelligent Customer Support Chatbot">Intelligent Customer Support Chatbot</option></select></div><br>
                    <div><label for="experience">Relevant Job Experience:</label><textarea id="experience" name="experience" rows="5"></textarea></div><br>
                    <div><label for="resumeLink">Resume Link (Google Drive, LinkedIn, etc.):</label><input type="url" id="resumeLink" name="resumeLink" placeholder="https://..." required></div>
                </fieldset>
            </div>

            <!-- Step 3: Availability -->
            <div class="form-step">
                 <fieldset>
                    <legend>Availability</legend>
                    <div><label for="startTime">Start of Available Time:</label><input type="time" id="startTime" name="startTime" required></div><br>
                    <div><label for="endTime">End of Available Time:</label><input type="time" id="endTime" name="endTime" required></div>
                </fieldset>
            </div>

            <!-- NEW: Navigation Buttons -->
            <div class="form-navigation">
                <button type="button" id="prevBtn" class="nav-btn">Previous</button>
                <button type="button" id="nextBtn" class="nav-btn">Next</button>
                <button type="submit" id="submitButton" class="nav-btn" style="display: none;">
                    <div class="loader"></div>
                    <span>Submit Application</span>
                </button>
            </div>
        </form>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>
        /** NEW: MULTI-STEP FORM LOGIC */
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitButton');
        const formSteps = Array.from(document.querySelectorAll('.form-step'));
        const progressSteps = Array.from(document.querySelectorAll('.progress-step'));
        const progressLine = document.getElementById('progress-line');

        let currentStep = 0;

        // Function to update button and step visibility
        function updateForm() {
            // Toggle active class on steps
            formSteps.forEach((step, index) => {
                step.classList.toggle('active-step', index === currentStep);
            });

            // Update progress bar
            progressSteps.forEach((step, index) => {
                if (index < currentStep + 1) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
            const activeSteps = document.querySelectorAll('.progress-step.active');
            progressLine.style.width = ((activeSteps.length - 1) / (progressSteps.length - 1)) * 100 + '%';


            // Update button visibility
            prevBtn.style.display = currentStep === 0 ? 'none' : 'inline-block';
            nextBtn.style.display = currentStep === formSteps.length - 1 ? 'none' : 'inline-block';
            submitBtn.style.display = currentStep === formSteps.length - 1 ? 'inline-flex' : 'none';
        }

        // Function to validate the current step's inputs
        function validateStep() {
            const currentFormStep = formSteps[currentStep];
            const inputs = currentFormStep.querySelectorAll('input[required], select[required], textarea[required]');
            let isValid = true;

            inputs.forEach(input => {
                if (!input.value.trim()) {
                    isValid = false;
                    input.classList.add('invalid'); // Add a class for styling invalid fields
                } else {
                    input.classList.remove('invalid');
                }
            });
            return isValid;
        }

        nextBtn.addEventListener('click', () => {
            if (validateStep()) {
                currentStep++;
                updateForm();
            } else {
                alert('Please fill out all required fields before proceeding.');
            }
        });

        prevBtn.addEventListener('click', () => {
            currentStep--;
            updateForm();
        });

        // Initialize the form view
        updateForm();


        /** FIREBASE SUBMISSION LOGIC (Unchanged, but now only triggered on the last step) */
        const firebaseConfig = {
          apiKey: "AIzaSyBTwpumTfWCBe_19oepZiS_8HdMlV6_VRU",
          authDomain: "lifewoodapplicants.firebaseapp.com",
          projectId: "lifewoodapplicants",
          storageBucket: "lifewoodapplicants.firebasestorage.app",
          messagingSenderId: "511466490168",
          appId: "1:511466490168:web:3e8e6134e68feaec0b99cd",
          measurementId: "G-QPHRJCGRBY"
        };
        if (!firebase.apps.length) {
             firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        const applicationForm = document.getElementById('applicationForm');
        
        const loader = submitBtn.querySelector('.loader');
        const buttonText = submitBtn.querySelector('span');

        applicationForm.addEventListener('submit', (e) => {
            e.preventDefault();

            // Final validation before submitting
            if (!validateStep()) {
                 alert('Please fill out all required fields before submitting.');
                 return;
            }

            loader.style.display = 'block';
            buttonText.textContent = 'Submitting...';
            submitBtn.disabled = true;

            const applicationData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                age: document.getElementById('age').value,
                degree: document.getElementById('degree').value,
                projectApplied: document.getElementById('projectApplied').value,
                experience: document.getElementById('experience').value,
                resumeLink: document.getElementById('resumeLink').value,
                startTime: document.getElementById('startTime').value,
                endTime: document.getElementById('endTime').value,
                status: 'pending',
                submittedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            db.collection("applications").add(applicationData)
                .then((docRef) => {
                    console.log("Application submitted with ID: ", docRef.id);
                    alert("Thank you! Your application has been submitted successfully.");
                    applicationForm.reset();
                    window.location.href = 'index.html'; 
                })
                .catch((error) => {
                    console.error("Error adding document: ", error);
                    alert("There was an error submitting your application. Please try again.");
                })
                .finally(() => {
                    loader.style.display = 'none';
                    buttonText.textContent = 'Submit Application';
                    submitBtn.disabled = false;
                });
        });
    </script>
</body>
</html>